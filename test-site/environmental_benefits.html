<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Environmental Benefits</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      width: 90%;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 20px;
      position: relative;
    }

    .card {
      background: white;
      border-radius: 12px;
      border: none;
      width: 100%;
      height: 100%;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: pointer;
    }

    .card:hover {
      transform: scale(1.05);
    }

    .icon {
      width: 128px;
      height: 128px;
      margin: 0 auto;
      animation: float 2s infinite ease-in-out;
    }

    .icon img {
      width: 100%;
      height: auto;
      background-color: transparent;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }

    .label {
      font-size: 1.6rem;
      margin-top: 10px;
      color: #444;
    }

    .value {
      font-size: 2rem;
      font-weight: bold;
      color: #2e7d32;
      margin-top: 5px;
    }

    .card.expand {
      position: absolute;
      transform: none !important;
      z-index: 10;
      border-radius: 0;
      transition: all 0.7s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="card">
      <div class="icon">
        <img src="images/tree_icon.png" alt="Tree Image">
      </div>
      <div class="label">Equivalent Trees Planted</div>
      <div class="value" id="treesPlanted">N/A Trees</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/car_icon.png" alt="Car Image">
      </div>
      <div class="label">Electric cars powered (1 yr)</div>
      <div class="value" id="carsPowered">N/A cars</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/CO2_icon.png" alt="CO2 Image">
      </div>
      <div class="label">CO₂ Emissions Avoided</div>
      <div class="value" id="CO2Avoided">N/A tCO₂e</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/phone_icon.png" alt="Phone Image">
      </div>
      <div class="label">Phones Charged</div>
      <div class="value" id="phonesCharged">N/A phones</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/sun_icon.png" alt="Sun Image">
      </div>
      <div class="label">Days of Clean Energy</div>
      <div class="value" id="operatingDays">N/A days</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/gas_icon.png" alt="Gas Image">
      </div>
      <div class="label">Gallons of gasoline offset</div>
      <div class="value" id="gasolineGallons">N/A gallons</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/gas_icon.png" alt="Kilometers Image">
      </div>
      <div class="label">Kilometers driven by gas vehicle</div>
      <div class="value" id="kmsDriven">N/A Km</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/gas_icon.png" alt="Display Hours Image">
      </div>
      <div class="label">Hours that the energy can run this display</div>
      <div class="value" id="displayHours">N/A hours</div>
    </button>
    <button class="card">
      <div class="icon">
        <img src="images/gas_icon.png" alt="Litter Removed Image">
      </div>
      <div class="label">Litter removed from the Grand Pacific Ocean</div>
      <div class="value" id="yearlyTrash">N/A tons</div>
    </button>
  </div>

  <script>
    const carsPowered = document.getElementById("carsPowered");
    const treesPlanted = document.getElementById("treesPlanted");
    const gasolineGallons = document.getElementById("gasolineGallons");
    const CO2Avoided = document.getElementById("CO2Avoided");
    const phonesCharged = document.getElementById("phonesCharged");
    const operatingDays = document.getElementById("operatingDays");
    const kmsDriven = document.getElementById("kmsDriven");
    const displayHours = document.getElementById("displayHours");
    const yearlyTrash = document.getElementById("yearlyTrash");

    function sumArray(accumulator, element) {
      return accumulator + element;
    }

    function getCO2(energy) {
      return energy * 9.9e-6;
    }

    function getSmartphonesCharged(energy) {
      return (energy / 0.02035).toFixed(0);
    }

    function getTreeCount(energy) {
      return (getCO2(energy) / 0.06).toFixed(0);
    }

    function getGasolineGallons(energy) {
      return (getCO2(energy) / 0.0093715).toFixed(2);
    }

    function getYearlyCarsPowered(energy) {
      return (energy / 3071).toFixed(0);
    }

    function getKmsDriven(energy) {
      return (getCO2(energy) / 2.66e-4).toFixed(2);
    }

    function getDisplayHours(energy) {
      return (energy / 0.215).toFixed(0);
    }

    function getLitterRemoved(yearlyEnergy) {
      return (getCO2(yearlyEnergy) * 365).toFixed(2);
    }

    async function getOperationalTime() {
      const response = await fetch("https://clients.hakaienergy.ca/camosun/api-update.php?api=systems_summary");
      const rawData = await response.json();
      const operationalSeconds = rawData.last_report_at - rawData.operational_at;
      return (operationalSeconds / 86400).toFixed(0);
    }

    async function getTotalEnergyProduced() {
      const response = await fetch("https://clients.hakaienergy.ca/camosun/api-update.php?api=systems_summary");
      const rawData = await response.json();
      return rawData.energy_lifetime;
    }

    async function getYearlyEnergyProduced() {
      const response = await fetch("https://clients.hakaienergy.ca/camosun/get_site_energy.php?t=DAY&r=-1 year&f=json");
      const rawData = await response.json();
      const values = rawData.map(item => item.value);
      return values.reduce(sumArray);
    }

    async function setEnvironmentalBenefits() {
      let energy = await getTotalEnergyProduced();
      energy /= 1000;
      let yearlyEnergy = await getYearlyEnergyProduced();
      yearlyEnergy /= 1000;

      treesPlanted.textContent = `${getTreeCount(energy)} trees`;
      carsPowered.textContent = `${getYearlyCarsPowered(energy)} cars`;
      gasolineGallons.textContent = `${getGasolineGallons(energy)} gallons`;
      CO2Avoided.textContent = `${getCO2(energy).toFixed(2)} tCO₂`;
      phonesCharged.textContent = `${getSmartphonesCharged(energy)} phones`;
      operatingDays.textContent = `${await getOperationalTime()} days`;
      kmsDriven.textContent = `${getKmsDriven(energy)} Km`;
      displayHours.textContent = `${getDisplayHours(energy)} hours`;
      yearlyTrash.textContent = `${getLitterRemoved(yearlyEnergy)} tons`;
    }

    setEnvironmentalBenefits();

    // Animation handler
    document.querySelectorAll(".card").forEach(card => {
      card.addEventListener("click", () => {
        const container = document.querySelector(".container");
        const rect = card.getBoundingClientRect();
        const containerRect = container.getBoundingClientRect();

        const orig = {
          top: rect.top - containerRect.top + "px",
          left: rect.left - containerRect.left + "px",
          width: rect.width + "px",
          height: rect.height + "px",
          radius: getComputedStyle(card).borderRadius
        };

        const clone = card.cloneNode(true);
        clone.classList.add("expand");
        Object.assign(clone.style, {
          position: "absolute",
          top: orig.top,
          left: orig.left,
          width: orig.width,
          height: orig.height,
          borderRadius: orig.radius,
          background: "white",
          cursor: "pointer"
        });

        container.appendChild(clone);
        void clone.offsetWidth;

        Object.assign(clone.style, {
          top: "0",
          left: "0",
          width: "100%",
          height: "100%",
          borderRadius: "0"
        });

        setTimeout(() => {
          clone.innerHTML = `<h1 style="font-size:4rem; color:#2e7d32; margin:0;">Documentation</h1>`;
          clone.addEventListener("click", () => {
            Object.assign(clone.style, {
              top: orig.top,
              left: orig.left,
              width: orig.width,
              height: orig.height,
              borderRadius: orig.radius
            });
            clone.addEventListener("transitionend", () => {
              clone.remove();
            }, { once: true });
          }, { once: true });
        }, 700);
      });
    });
  </script>
</body>
</html>
